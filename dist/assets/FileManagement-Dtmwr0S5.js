import{aA as L,f as y,h as A,v as z,c as p,o as c,F as o,Q as S,Z as x,T as C,I as N,U as b,aa as _,x as O,r as I,M as j,az as k,a as E,O as U,S as M}from"./vendor-cKlqYlgl.js";import{u as V}from"./directory-BorMR0YW.js";import{t as R,r as W,s as Q}from"./statistics-DxPUy0bq.js";import{f as g,c as F,h as Z,g as G,u as D,o as H,a as J,b as K,d as X,e as Y,p as q,r as $,i as ee,_ as B}from"./index-iXBYOgta.js";import"./utils-Dq7h7Pqt.js";const T={id:"root",name:"根目录",type:"folder",path:"/",size:0,fileCount:2847,folderCount:156,createdAt:"2023-01-01 10:00:00",updatedAt:"2024-01-15 14:30:25",children:[{id:"documents",name:"文档",type:"folder",path:"/documents",size:7303014400,fileCount:1024,folderCount:12,createdAt:"2023-01-15 09:30:00",updatedAt:"2024-01-15 11:20:15",children:[{id:"work",name:"工作文档",type:"folder",path:"/documents/work",size:3221225472,fileCount:456,folderCount:8,createdAt:"2023-02-01 14:00:00",updatedAt:"2024-01-15 09:45:30",children:[{id:"projects",name:"项目文档",type:"folder",path:"/documents/work/projects",size:1610612736,fileCount:234,folderCount:5,createdAt:"2023-03-01 16:20:00",updatedAt:"2024-01-14 17:30:45"},{id:"reports",name:"报告",type:"folder",path:"/documents/work/reports",size:805306368,fileCount:124,folderCount:2,createdAt:"2023-03-15 11:45:00",updatedAt:"2024-01-12 13:20:10"},{id:"contracts",name:"合同",type:"folder",path:"/documents/work/contracts",size:536870912,fileCount:98,folderCount:1,createdAt:"2023-04-01 08:30:00",updatedAt:"2024-01-10 16:15:25"}]},{id:"personal",name:"个人文档",type:"folder",path:"/documents/personal",size:2147483648,fileCount:298,folderCount:3,createdAt:"2023-02-15 10:15:00",updatedAt:"2024-01-13 20:30:45",children:[{id:"finance",name:"财务",type:"folder",path:"/documents/personal/finance",size:268435456,fileCount:89,folderCount:0,createdAt:"2023-05-01 12:00:00",updatedAt:"2024-01-08 19:45:30"},{id:"health",name:"健康",type:"folder",path:"/documents/personal/health",size:134217728,fileCount:45,folderCount:0,createdAt:"2023-06-01 15:30:00",updatedAt:"2024-01-05 14:20:15"}]},{id:"archive",name:"归档文档",type:"folder",path:"/documents/archive",size:1610612736,fileCount:270,folderCount:1,createdAt:"2023-01-20 13:45:00",updatedAt:"2023-12-15 10:30:20"}]},{id:"media",name:"媒体文件",type:"folder",path:"/media",size:8589934592,fileCount:1278,folderCount:18,createdAt:"2023-01-20 16:00:00",updatedAt:"2024-01-15 12:45:30",children:[{id:"images",name:"图片",type:"folder",path:"/media/images",size:4509715456,fileCount:856,folderCount:12,createdAt:"2023-02-01 09:00:00",updatedAt:"2024-01-15 08:30:15",children:[{id:"photos",name:"照片",type:"folder",path:"/media/images/photos",size:3221225472,fileCount:624,folderCount:8,createdAt:"2023-02-10 14:20:00",updatedAt:"2024-01-14 19:15:45"},{id:"screenshots",name:"截图",type:"folder",path:"/media/images/screenshots",size:805306368,fileCount:156,folderCount:2,createdAt:"2023-03-01 11:30:00",updatedAt:"2024-01-13 16:20:30"},{id:"graphics",name:"设计图",type:"folder",path:"/media/images/graphics",size:483183820,fileCount:76,folderCount:2,createdAt:"2023-04-15 13:45:00",updatedAt:"2024-01-11 15:10:20"}]},{id:"videos",name:"视频",type:"folder",path:"/media/videos",size:3328155648,fileCount:124,folderCount:4,createdAt:"2023-02-20 10:30:00",updatedAt:"2024-01-12 21:45:10",children:[{id:"tutorials",name:"教程",type:"folder",path:"/media/videos/tutorials",size:1610612736,fileCount:45,folderCount:2,createdAt:"2023-05-01 16:00:00",updatedAt:"2024-01-10 14:30:25"},{id:"presentations",name:"演示",type:"folder",path:"/media/videos/presentations",size:1073741824,fileCount:34,folderCount:1,createdAt:"2023-06-15 12:15:00",updatedAt:"2024-01-08 18:20:45"}]},{id:"audio",name:"音频",type:"folder",path:"/media/audio",size:935329792,fileCount:298,folderCount:2,createdAt:"2023-03-01 15:45:00",updatedAt:"2024-01-09 20:15:30"}]},{id:"projects",name:"项目",type:"folder",path:"/projects",size:2684354560,fileCount:456,folderCount:24,createdAt:"2023-01-25 11:20:00",updatedAt:"2024-01-15 13:50:40",children:[{id:"web-development",name:"Web开发",type:"folder",path:"/projects/web-development",size:1610612736,fileCount:289,folderCount:15,createdAt:"2023-02-01 09:30:00",updatedAt:"2024-01-15 13:50:40"},{id:"mobile-apps",name:"移动应用",type:"folder",path:"/projects/mobile-apps",size:805306368,fileCount:134,folderCount:6,createdAt:"2023-03-15 14:00:00",updatedAt:"2024-01-12 16:25:15"},{id:"data-analysis",name:"数据分析",type:"folder",path:"/projects/data-analysis",size:268435456,fileCount:33,folderCount:3,createdAt:"2023-07-01 10:45:00",updatedAt:"2024-01-05 12:30:20"}]},{id:"backup",name:"备份",type:"folder",path:"/backup",size:1932735283,fileCount:89,folderCount:3,createdAt:"2023-01-10 08:00:00",updatedAt:"2024-01-01 02:30:00"},{id:"temp",name:"临时文件",type:"folder",path:"/temp",size:536870912,fileCount:156,folderCount:2,createdAt:"2024-01-01 00:00:00",updatedAt:"2024-01-15 14:30:25"}]},te=[{id:"root",name:"根目录",path:"/",parentId:null,level:0},{id:"documents",name:"文档",path:"/documents",parentId:"root",level:1},{id:"work",name:"工作文档",path:"/documents/work",parentId:"documents",level:2},{id:"projects",name:"项目文档",path:"/documents/work/projects",parentId:"work",level:3},{id:"reports",name:"报告",path:"/documents/work/reports",parentId:"work",level:3},{id:"contracts",name:"合同",path:"/documents/work/contracts",parentId:"work",level:3},{id:"personal",name:"个人文档",path:"/documents/personal",parentId:"documents",level:2},{id:"finance",name:"财务",path:"/documents/personal/finance",parentId:"personal",level:3},{id:"health",name:"健康",path:"/documents/personal/health",parentId:"personal",level:3},{id:"archive",name:"归档文档",path:"/documents/archive",parentId:"documents",level:2},{id:"media",name:"媒体文件",path:"/media",parentId:"root",level:1},{id:"images",name:"图片",path:"/media/images",parentId:"media",level:2},{id:"photos",name:"照片",path:"/media/images/photos",parentId:"images",level:3},{id:"screenshots",name:"截图",path:"/media/images/screenshots",parentId:"images",level:3},{id:"graphics",name:"设计图",path:"/media/images/graphics",parentId:"images",level:3},{id:"videos",name:"视频",path:"/media/videos",parentId:"media",level:2},{id:"tutorials",name:"教程",path:"/media/videos/tutorials",parentId:"videos",level:3},{id:"presentations",name:"演示",path:"/media/videos/presentations",parentId:"videos",level:3},{id:"audio",name:"音频",path:"/media/audio",parentId:"media",level:2},{id:"web-development",name:"Web开发",path:"/projects/web-development",parentId:"projects",level:2},{id:"mobile-apps",name:"移动应用",path:"/projects/mobile-apps",parentId:"projects",level:2},{id:"data-analysis",name:"数据分析",path:"/projects/data-analysis",parentId:"projects",level:2},{id:"backup",name:"备份",path:"/backup",parentId:"root",level:1},{id:"temp",name:"临时文件",path:"/temp",parentId:"root",level:1}],P={getSystemStats:()=>Promise.resolve(Q),getRealtimeStats:()=>Promise.resolve(W),getTrendData:()=>Promise.resolve(R),getDirectoryTree:()=>Promise.resolve(T),getFlatDirectories:()=>Promise.resolve(te),getDirectoryById:t=>{const e=s=>{if(s.id===t)return s;if(s.children)for(const a of s.children){const u=e(a);if(u)return u}return null};return Promise.resolve(e(T))},getAllFiles:()=>Promise.resolve(g),getFilesByDirectory:t=>Promise.resolve(ee[t]||[]),getRecentFiles:(t=10)=>Promise.resolve($.slice(0,t)),getPopularFiles:(t=10)=>Promise.resolve(q.slice(0,t)),getFavoriteFiles:()=>Promise.resolve(Y),getFilesByType:t=>Promise.resolve(X[t]||[]),getFileById:t=>Promise.resolve(g.find(e=>e.id===t)),searchFiles:t=>{const e=g.filter(s=>{var a,u;return s.name.toLowerCase().includes(t.toLowerCase())||((a=s.description)==null?void 0:a.toLowerCase().includes(t.toLowerCase()))||((u=s.tags)==null?void 0:u.some(m=>m.toLowerCase().includes(t.toLowerCase())))});return Promise.resolve(e)},getAllUsers:()=>Promise.resolve(K),getUserById:t=>Promise.resolve(J(t)),getCurrentUser:()=>Promise.resolve(F),getOnlineUsers:()=>Promise.resolve(H),getUserActivityLogs:t=>{const e=t?D.filter(s=>s.userId===t):D;return Promise.resolve(e)},getUserPermissions:t=>Promise.resolve(G(t)),hasPermission:(t,e)=>Promise.resolve(Z(t,e)),uploadFile:t=>new Promise(e=>{setTimeout(()=>{const s={id:`file_${Date.now()}`,name:t.name,size:t.size,type:"file",extension:t.name.split(".").pop(),createdAt:new Date().toISOString().replace("T"," ").substring(0,19),updatedAt:new Date().toISOString().replace("T"," ").substring(0,19),createdBy:F.id,updatedBy:F.id,downloadCount:0,viewCount:0,favorited:!1};e(s)},1e3)}),downloadFile:t=>new Promise(e=>{setTimeout(()=>{const s=g.find(a=>a.id===t);s?(s.downloadCount+=1,e({success:!0,file:s})):e({success:!1,error:"文件不存在"})},500)}),deleteFile:t=>new Promise(e=>{setTimeout(()=>{const s=g.findIndex(a=>a.id===t);s!==-1?(g.splice(s,1),e({success:!0})):e({success:!1,error:"文件不存在"})},300)}),createDirectory:(t,e)=>new Promise(s=>{setTimeout(()=>{const a={id:`dir_${Date.now()}`,name:t,type:"folder",parentId:e,path:`${e==="root"?"":e}/${t}`,size:0,fileCount:0,folderCount:0,createdAt:new Date().toISOString().replace("T"," ").substring(0,19),updatedAt:new Date().toISOString().replace("T"," ").substring(0,19)};s(a)},500)}),renameFile:(t,e)=>new Promise(s=>{setTimeout(()=>{const a=g.find(u=>u.id===t);a?(a.name=e,a.updatedAt=new Date().toISOString().replace("T"," ").substring(0,19),s({success:!0,file:a})):s({success:!1,error:"文件不存在"})},300)}),moveFile:(t,e)=>new Promise(s=>{setTimeout(()=>{const a=g.find(u=>u.id===t);a?(a.directoryId=e,a.updatedAt=new Date().toISOString().replace("T"," ").substring(0,19),s({success:!0,file:a})):s({success:!1,error:"文件不存在"})},500)}),toggleFavorite:t=>new Promise(e=>{setTimeout(()=>{const s=g.find(a=>a.id===t);s?(s.favorited=!s.favorited,s.updatedAt=new Date().toISOString().replace("T"," ").substring(0,19),e({success:!0,file:s,favorited:s.favorited})):e({success:!1,error:"文件不存在"})},200)})},se=L("file",()=>{const t=y([]),e=y([]),s=y(!1),a=y(null),u=y("grid"),m=y("name"),h=y("asc"),v=A(()=>[...t.value].sort((n,l)=>{let d=n[m.value],f=l[m.value];return m.value==="size"?(d=Number(d),f=Number(f)):m.value==="createTime"?(d=new Date(d),f=new Date(f)):(d=String(d).toLowerCase(),f=String(f).toLowerCase()),h.value==="desc"?f>d?1:-1:d>f?1:-1})),i=A(()=>e.value.map(r=>r.id)),w=A(()=>e.value.length>0);return{files:t,selectedFiles:e,loading:s,error:a,viewMode:u,sortBy:m,sortOrder:h,sortedFiles:v,selectedFileIds:i,hasSelectedFiles:w,fetchFiles:async r=>{s.value=!0,a.value=null;try{const n=await P.getFilesByDirectory(r);t.value=n,e.value=[]}catch(n){a.value=n.message||"获取文件列表失败"}finally{s.value=!1}},searchFiles:async(r,n=null,l=null)=>{s.value=!0,a.value=null;try{let d=await P.searchFiles(r);n&&(d=d.filter(f=>f.directoryId===n)),l&&(d=d.filter(f=>f.extension===l)),t.value=d.slice(0,20),e.value=[]}catch(d){a.value=d.message||"搜索文件失败"}finally{s.value=!1}},selectFile:r=>{const n=e.value.findIndex(l=>l.id===r.id);n>-1?e.value.splice(n,1):e.value.push(r)},selectAllFiles:()=>{e.value.length===t.value.length?e.value=[]:e.value=[...t.value]},clearSelection:()=>{e.value=[]},deleteFiles:async r=>{s.value=!0,a.value=null;try{return await new Promise(n=>setTimeout(n,500)),t.value=t.value.filter(n=>!r.includes(n.id)),e.value=e.value.filter(n=>!r.includes(n.id)),{success:r.length,failed:0}}catch(n){throw a.value=n.message||"删除文件失败",n}finally{s.value=!1}},renameFile:async(r,n)=>{s.value=!0,a.value=null;try{await new Promise(d=>setTimeout(d,300));const l=t.value.find(d=>d.id===r);if(!l)throw new Error("文件不存在");return l.name=n,l.updateTime=new Date().toISOString(),l}catch(l){throw a.value=l.message||"重命名文件失败",l}finally{s.value=!1}},moveFiles:async(r,n)=>{s.value=!0,a.value=null;try{return await new Promise(l=>setTimeout(l,400)),t.value.forEach(l=>{r.includes(l.id)&&(l.directoryId=n,l.updateTime=new Date().toISOString())}),{success:r.length,failed:0}}catch(l){throw a.value=l.message||"移动文件失败",l}finally{s.value=!1}},downloadFile:async r=>{try{const n=t.value.find(l=>l.id===r);if(!n)throw new Error("文件不存在");return console.log(`下载文件: ${n.name}`),n.downloadCount++,!0}catch(n){throw a.value=n.message||"下载文件失败",n}},setViewMode:r=>{u.value=r},setSortBy:r=>{m.value===r?h.value=h.value==="asc"?"desc":"asc":(m.value=r,h.value="asc")},clearError:()=>{a.value=null}}}),ae={name:"TreeNode",props:{node:{type:Object,required:!0},currentId:{type:String,default:""},level:{type:Number,default:0}},emits:["node-select"],setup(t,{emit:e}){const s=y(t.level===0),a=A(()=>t.node.children&&t.node.children.length>0),u=()=>{s.value=!s.value,O(()=>{window.lucide&&window.lucide.createIcons()})},m=()=>{e("node-select",t.node)};return z(()=>{window.lucide&&window.lucide.createIcons()}),{isExpanded:s,hasChildren:a,toggleExpanded:u,handleNodeClick:m}}},oe={class:"tree-node"},ie=["data-lucide"],ne={key:1,class:"node-toggle placeholder"},re={class:"node-name"},le={key:2,class:"node-count"},de={key:0,class:"node-children"};function ce(t,e,s,a,u,m){const h=I("TreeNode",!0);return c(),p("div",oe,[o("div",{class:N(["node-content",{active:s.currentId===s.node.id}]),onClick:e[1]||(e[1]=(...v)=>a.handleNodeClick&&a.handleNodeClick(...v))},[a.hasChildren?(c(),p("div",{key:0,class:"node-toggle",onClick:e[0]||(e[0]=x((...v)=>a.toggleExpanded&&a.toggleExpanded(...v),["stop"]))},[o("i",{"data-lucide":a.isExpanded?"chevron-down":"chevron-right",class:"toggle-icon"},null,8,ie)])):(c(),p("div",ne)),e[3]||(e[3]=o("i",{"data-lucide":"folder",class:"node-icon"},null,-1)),o("span",re,C(s.node.name),1),s.node.fileCount!==void 0?(c(),p("span",le,"("+C(s.node.fileCount)+")",1)):S("",!0)],2),a.hasChildren&&a.isExpanded?(c(),p("div",de,[(c(!0),p(b,null,_(s.node.children,v=>(c(),j(h,{key:v.id,node:v,"current-id":s.currentId,level:s.level+1,onNodeSelect:e[2]||(e[2]=i=>t.$emit("node-select",i))},null,8,["node","current-id","level"]))),128))])):S("",!0)])}const ue=B(ae,[["render",ce],["__scopeId","data-v-9d9ec745"]]),pe={name:"FileManagement",components:{TreeNode:ue},setup(){const t=V(),e=se(),s=y("root");return z(async()=>{if(window.lucide&&window.lucide.createIcons(),await t.fetchDirectoryTree(),t.directoryTree.length>0&&t.directoryTree[0].children){const i=t.directoryTree[0].children[0];i&&(s.value=i.id,await e.fetchFiles(i.id))}}),{directoryStore:t,fileStore:e,currentDirectoryId:s,selectDirectory:async i=>{s.value=i.id,t.setCurrentDirectory(i),await e.fetchFiles(i.id)},selectFile:i=>{e.selectFile(i)},downloadFile:async i=>{console.log("下载文件:",i.name)},getFileIcon:i=>({pdf:"file-text",doc:"file-text",docx:"file-text",txt:"file-text",md:"file-text",jpg:"image",jpeg:"image",png:"image",gif:"image",mp4:"video",mp3:"music",zip:"archive",rar:"archive",xlsx:"file-spreadsheet",xls:"file-spreadsheet",pptx:"presentation",ppt:"presentation",js:"code",ts:"code",html:"code",css:"code",vue:"code"})[i==null?void 0:i.toLowerCase()]||"file",formatDate:i=>i?new Date(i).toLocaleDateString("zh-CN",{year:"numeric",month:"numeric",day:"numeric"}):""}}},me={class:"file-management"},fe={class:"file-management-container"},ve={class:"page-header"},he={class:"header-actions"},ge={class:"main-content"},ye={class:"sidebar"},we={class:"directory-tree"},Ce={key:0,class:"tree-loading"},Ae={key:1,class:"tree-content"},Fe={key:2,class:"tree-placeholder"},be={class:"content-area"},_e={class:"file-list"},Ie={key:0,class:"list-loading"},Se={key:1,class:"file-grid"},ke=["onClick"],De={class:"file-icon"},Te=["data-lucide"],Pe={class:"file-info"},ze={class:"file-name"},xe={class:"file-details"},Ne={class:"file-actions"},je=["onClick"],Be={key:2,class:"list-placeholder"};function Le(t,e,s,a,u,m){const h=I("router-link"),v=I("TreeNode");return c(),p("div",me,[o("div",fe,[o("header",ve,[e[1]||(e[1]=k('<div class="header-content" data-v-2036b734><div class="header-icon" data-v-2036b734><i data-lucide="folder-open" class="header-icon-svg" data-v-2036b734></i></div><div class="header-text" data-v-2036b734><h1 class="page-title" data-v-2036b734>文件管理</h1><p class="page-subtitle" data-v-2036b734>管理您的文件和文档</p></div></div>',1)),o("div",he,[E(h,{to:"/",class:"btn btn-secondary"},{default:U(()=>e[0]||(e[0]=[o("i",{"data-lucide":"home",class:"btn-icon"},null,-1),M(" 返回首页 ")])),_:1})])]),o("div",ge,[o("aside",ye,[e[4]||(e[4]=o("div",{class:"sidebar-header"},[o("div",{class:"sidebar-title"},[o("i",{"data-lucide":"folder-tree",class:"sidebar-icon"}),o("h3",null,"目录结构")])],-1)),o("div",we,[a.directoryStore.loading?(c(),p("div",Ce,e[2]||(e[2]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"加载中...",-1)]))):a.directoryStore.directoryTree.length>0?(c(),p("div",Ae,[(c(!0),p(b,null,_(a.directoryStore.directoryTree,i=>(c(),j(v,{key:i.id,node:i,"current-id":a.currentDirectoryId,level:0,onNodeSelect:a.selectDirectory},null,8,["node","current-id","onNodeSelect"]))),128))])):(c(),p("div",Fe,e[3]||(e[3]=[o("div",{class:"placeholder-icon"},[o("i",{"data-lucide":"folder",class:"placeholder-icon-svg"})],-1),o("h4",null,"暂无目录",-1),o("p",null,"请先创建一些目录",-1)])))])]),o("main",be,[e[8]||(e[8]=k('<div class="toolbar" data-v-2036b734><div class="search-section" data-v-2036b734><div class="search-input-wrapper" data-v-2036b734><i data-lucide="search" class="search-icon" data-v-2036b734></i><input type="text" placeholder="搜索文件..." class="search-input" disabled data-v-2036b734></div></div><div class="action-section" data-v-2036b734><button class="btn btn-primary" disabled data-v-2036b734><i data-lucide="upload-cloud" class="btn-icon" data-v-2036b734></i> 上传文件 </button></div></div>',1)),o("div",_e,[a.fileStore.loading?(c(),p("div",Ie,e[5]||(e[5]=[o("div",{class:"loading-spinner"},null,-1),o("p",null,"加载文件中...",-1)]))):a.fileStore.files.length>0?(c(),p("div",Se,[(c(!0),p(b,null,_(a.fileStore.sortedFiles,i=>(c(),p("div",{key:i.id,class:N(["file-item",{selected:a.fileStore.selectedFileIds.includes(i.id)}]),onClick:w=>a.selectFile(i)},[o("div",De,[o("i",{"data-lucide":a.getFileIcon(i.extension),class:"file-icon-svg"},null,8,Te)]),o("div",Pe,[o("h4",ze,C(i.name),1),o("p",xe,C(i.formattedSize)+" • "+C(a.formatDate(i.updatedAt)),1)]),o("div",Ne,[o("button",{class:"action-btn",onClick:x(w=>a.downloadFile(i),["stop"])},e[6]||(e[6]=[o("i",{"data-lucide":"download",class:"action-icon"},null,-1)]),8,je)])],10,ke))),128))])):(c(),p("div",Be,e[7]||(e[7]=[o("div",{class:"placeholder-icon"},[o("i",{"data-lucide":"folder-open",class:"placeholder-icon-svg"})],-1),o("h3",null,"此目录为空",-1),o("p",null,"这里还没有文件，可以上传一些文件",-1)])))])])])])])}const et=B(pe,[["render",Le],["__scopeId","data-v-2036b734"]]);export{et as default};
